# Document Upload Feature - Usage Guide

## Overview

The document upload feature allows you to import existing PRDs from Microsoft Word (.docx) or Markdown (.md) files into the cvPRD knowledge graph system.

## Features

- **Automatic Parsing**: Converts Word and Markdown documents into structured PRD format
- **Smart Section Detection**: Recognizes common PRD sections (requirements, features, risks, etc.)
- **Priority Assignment**: Automatically assigns priorities based on keywords (critical, high, medium, low)
- **Tag Extraction**: Extracts tags from section titles and content
- **Knowledge Graph Integration**: Processes documents through the same pipeline as manually created PRDs

## Installation

Install the required dependencies:

```bash
cd backend
source venv/bin/activate
pip install python-docx markdown pypdf
```

Or install from requirements.txt:

```bash
pip install -r requirements.txt
```

## Command Line Usage

### Basic Usage

```bash
# From the backend directory
cd backend
source venv/bin/activate

# Upload a markdown file
venv/bin/python upload_document.py path/to/your/document.md

# Upload a Word document
venv/bin/python upload_document.py path/to/your/document.docx
```

### Advanced Options

```bash
# Specify custom name and description
venv/bin/python upload_document.py document.md \
  --name "Mobile App PRD" \
  --description "Requirements for the new mobile application"

# Parse only (skip vector/graph processing)
venv/bin/python upload_document.py document.md --skip-processing

# Verbose output
venv/bin/python upload_document.py document.md --verbose
```

### Command Line Arguments

- `file_path` (required): Path to the document file
- `--name, -n`: Custom name for the PRD (defaults to filename)
- `--description, -d`: Description for the PRD (defaults to excerpt from first section)
- `--skip-processing`: Only parse the document without processing into databases
- `--verbose, -v`: Enable verbose logging output

## Document Format Guidelines

### Markdown Documents

Structure your markdown PRD with clear headings:

```markdown
# PRD Title

## Section 1
Content here...

## Section 2
Content here...

### Subsection 2.1
More content...
```

**Tips for Markdown:**
- Use `#` for main title (becomes PRD name if not specified)
- Use `##` and `###` for sections and subsections
- Include keywords like "critical", "required", "must have" for priority assignment
- Use hashtags in content for additional tags (e.g., `#mobile #payments`)

### Word Documents (.docx)

Structure your Word document with heading styles:

- **Heading 1**: Main sections
- **Heading 2**: Subsections
- **Normal text**: Section content

**Tips for Word Documents:**
- Use Word's built-in heading styles (Heading 1, Heading 2, etc.)
- The first heading becomes the PRD name if not specified
- Keywords in headings and content determine priority levels

## Recognized Section Types

The parser automatically recognizes and tags these common PRD sections:

- **Overview**: overview, summary, introduction, executive summary
- **Objectives**: objectives, goals, purpose
- **Requirements**: requirements, functional requirements, specifications
- **Features**: features, capabilities, functionality
- **Constraints**: constraints, limitations, restrictions
- **Stakeholders**: stakeholders, users, audience
- **Metrics**: metrics, KPIs, success criteria, measurements
- **Dependencies**: dependencies, prerequisites, integrations
- **Risks**: risks, challenges, concerns
- **Timeline**: timeline, schedule, milestones

## Priority Assignment

Priorities are automatically assigned based on keywords:

- **CRITICAL**: "critical", "must have", "essential", "required", "mandatory"
- **HIGH**: "important", "high priority", "key", "core"
- **LOW**: "nice to have", "optional", "future", "low priority"
- **MEDIUM**: Default priority when no keywords are found

## Example Documents

### Sample Markdown PRD

A sample PRD has been created at `/sample_prd.md` demonstrating proper structure.

Test it with:

```bash
cd backend
venv/bin/python upload_document.py ../sample_prd.md --skip-processing
```

## Processing Workflow

When you upload a document, it goes through these steps:

1. **Parsing**: Document is converted to PRD structure with sections
2. **Chunking**: PRD sections are broken into semantic chunks
3. **Embedding**: Each chunk is converted to a vector embedding
4. **Vector Storage**: Chunks are indexed in Qdrant for semantic search
5. **Graph Creation**: Nodes and relationships are created in Neo4j
6. **Relationship Detection**: Semantic relationships between chunks are identified

## Output

After successful processing, you'll see:

```
PRD ID: <generated-uuid>
Name: <document-name>
Description: <auto-generated or custom>

Sections (X):
  1. Section Title
     Priority: critical/high/medium/low
     Tags: tag1, tag2, ...
     Content length: XXX characters

Processing Results:
  Chunks created: XX
  Relationships created: XX
  Graph Statistics: ...
  Vector Database Statistics: ...
```

## Integration with Existing Code

The document parser can be used programmatically:

```python
from app.services.document_parser import DocumentParser
from app.services.orchestrator import PRDOrchestrator

# Parse a document
prd = DocumentParser.parse_document(
    "path/to/document.md",
    prd_name="Custom Name",
    prd_description="Custom description"
)

# Process through orchestrator
orchestrator = PRDOrchestrator()
results = orchestrator.process_prd(prd)
orchestrator.close()
```

## Files Created

This feature adds the following files to the project:

- `/backend/app/services/document_parser.py` - Document parsing service
- `/backend/upload_document.py` - CLI tool for uploading documents
- `/backend/requirements.txt` - Updated with new dependencies
- `/sample_prd.md` - Sample PRD for testing
- `/DOCUMENT_UPLOAD_GUIDE.md` - This guide

## Next Steps

After getting the CLI working, you can:

1. Create a REST API endpoint for file uploads
2. Build a frontend upload interface with drag-and-drop
3. Add support for PDF documents
4. Implement batch upload for multiple documents
5. Add document validation and preview before processing

## Troubleshooting

### ModuleNotFoundError: No module named 'docx'

Make sure you've activated the virtual environment and installed dependencies:

```bash
cd backend
source venv/bin/activate
pip install python-docx markdown pypdf
```

### File not found error

Use absolute paths or paths relative to the backend directory:

```bash
# Good
venv/bin/python upload_document.py ../sample_prd.md

# Also good
venv/bin/python upload_document.py /full/path/to/document.md
```

### No sections detected

Ensure your document uses proper heading styles (Word) or markdown headers (`#`, `##`).
