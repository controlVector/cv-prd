#!/bin/bash
# CV-PRD Launcher for Snap

export PYTHONPATH="$SNAP/lib/python3.10/site-packages:$SNAP/app"
export PATH="$SNAP/usr/bin:$SNAP/bin:$PATH"

# Set default environment
export DATABASE_URL="${DATABASE_URL:-sqlite:///$SNAP_USER_DATA/cvprd.db}"
export QDRANT_URL="${QDRANT_URL:-http://localhost:6333}"
export FALKORDB_URL="${FALKORDB_URL:-redis://localhost:6380}"
export EMBEDDING_MODEL="${EMBEDDING_MODEL:-all-MiniLM-L6-v2}"

# Create data directory
mkdir -p "$SNAP_USER_DATA"

# Start the server
cd "$SNAP/app"
exec "$SNAP/usr/bin/python3" -m uvicorn app.main:app --host 0.0.0.0 --port 8000
